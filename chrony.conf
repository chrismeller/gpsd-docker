# Use GPSD as the reference clock via shared memory
# SHM 0 is the first shared memory segment that GPSD writes to
#refclock SHM 0 refid GPS precision 1e-1 offset 0.0 delay 0.0
refclock SOCK /run//chrony.ttyACM0.sock refid GPS
#refclock SOCK /run/chrony/chrony.clk.ttyACM0.sock offset 0.5 delay 0.1 refid NMEA noselect

# Allow local network to query NTP
# Replace 192.168.1.0/24 with your actual network range
allow 192.168.0.0/16
allow 10.0.0.0/8
allow 172.16.0.0/12

# Allow localhost
allow 127.0.0.1

# Make the system time drift gradually if needed
makestep 1 3

# Improve accuracy by increasing polling frequency
# Initial poll interval: 2^6 = 64 seconds
# Maximum poll interval: 2^10 = 1024 seconds
#minpoll 6
#maxpoll 10

rtcsync

# Reduce timing jitter
corrtimeratio 1.0

# Store system time data periodically
driftfile /var/lib/chrony/chrony.drift

# Create driftfile if it doesn't exist
keyfile /etc/chrony/chrony.keys

# Enable command socket for chronyc queries
bindcmdaddress 0.0.0.0
cmdallow all
#cmdallow 127.0.0.1
#cmdallow 172.16.0.0/12
cmdport 323

# Log file location
logdir /var/log/chrony

log rawmeasurements measurements statistics selection tracking rtc refclocks tempcomp 

# Logging settings
log measurements statistics tracking
