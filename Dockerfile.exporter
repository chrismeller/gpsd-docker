FROM debian:stable-slim@sha256:7cb087f19bcc175b96fbe4c2aef42ed00733a659581a80f6ebccfd8fe3185a3d AS builder

EXPOSE 9978

# Install build dependencies
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
       git \
       golang-go \
       ca-certificates

# Clone and build gpsd-exporter
RUN git clone https://github.com/natesales/gpsd-exporter.git /src \
    && cd /src \
    && go build -o gpsd-exporter .

FROM debian:stable-slim@sha256:7cb087f19bcc175b96fbe4c2aef42ed00733a659581a80f6ebccfd8fe3185a3d

# Copy the built binary
COPY --from=builder /src/gpsd-exporter /usr/bin/gpsd-exporter

ENTRYPOINT ["/usr/bin/gpsd-exporter", "-d", "gpsd:2947"]

